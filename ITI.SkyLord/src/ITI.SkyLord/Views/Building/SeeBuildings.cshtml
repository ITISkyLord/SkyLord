@addTagHelper "*, Microsoft.AspNet.Mvc.TagHelpers"
@model BuildingViewModel

@{
    ViewData[ "Title" ] = "View Buildings";
    Layout = "_Layout";
}

<ul>
    @for ( int i = 1; i <= Model.Layout.CurrentIsland.PossiblePositions; i++ )
    {
        Building building = Model.Layout.CurrentIsland.Buildings.Where( b => b.Position == i ).SingleOrDefault();
        <li>
            <h4>Emplacement @i :</h4>
            @if ( building == null )
            {
                <form asp-route-islandId="@Model.Layout.CurrentIsland.IslandId" asp-controller="Building" asp-action="AddBuilding">
                    <input type="number" value="@i" asp-for="@Model.Position" style="display : none" />
                    <div asp-validation-summary="ValidationSummary.All" class="text-danger"></div>

                    @Html.DropDownListFor( m => m.TargetBuilding, Model.AvailableConstructionBuildings, "-- Construire --", new { onchange = "this.form.submit()" } )
                </form>
            }
            else
            {
                @building.Name { Write( " ( Niveau " ); } @building.Level.Number { Write( " ) " ); }
                {
                    string nextLevelCost = " Coût du prochain niveau : Bois "
                        + Model.NextLevelCosts[i].Wood
                        + " Métal : " + Model.NextLevelCosts[ i ].Metal
                        + " Cristal : " + Model.NextLevelCosts[ i ].Cristal
                        + " Magie : " + Model.NextLevelCosts[ i ].Magic;
                    Write( nextLevelCost );
                }
                <form asp-route-islandId="@Model.Layout.CurrentIsland.IslandId" asp-controller="Building" asp-action="LevelUpBuilding">
                    <input type="number" value=@{ Write( (int)building.BuildingName ); } asp-for="@Model.TargetBuilding" style="display : none" />
                    <input type="number" value="@i" asp-for="@Model.Position" style="display : none" />
                    <button type="submit" class="btn btn-link navbar-btn navbar-link">Level Up </button>
                </form>
    }
        </li>
    }
</ul>
